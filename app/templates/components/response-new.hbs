<div class="new-response-container">
  <div class="top-row">
    <p class="response-date">{{format-date todaysDate 'Do MMM YYYY'}}</p>
    <p class="response-link">
      {{#link-to 'workspace.submission' model.workspace model.submission classNames="submission"}}
        <span class="simptip-position-left simptip-smooth" data-tooltip="View Submission in Workspace">
          <i class="fas fa-external-link-alt"></i>
        </span>
      {{/link-to}}
    </p>
  </div>
  <div class="response-title">
    Craft Response
  </div>
  <div class="response-users">
    <p>
      <span class="response-label">To:</span>
      <span class="response-value">{{model.student}}</span>
    </p>
    <p>
      <span class="response-label">From:</span>
      <span class="response-value">{{currentUser.username}}</span>
    </p>
  </div>
  <section class="response-content">
    <section class="response-more-details">
      {{#if existingResponses.length}}
        <p>
        There
          {{pluralize existingResponses.length 'is' 'are'}}
          {{#unless model.persisted}}already{{/unless}}
        <a class='other response' {{action toggleProperty 'showExisting'}}>{{existingResponses.length}} other
          {{pluralize existingResponses.length 'response' 'responses'}}
        </a> for this {{model.source}}.
        </p>
        {{#if showExisting}}
          <ul>
          {{#each existingResponses as |response|}}
            <li>
              {{#link-to 'response' response.id}}{{response.shortText}}{{/link-to}} from {{response.created}}
            </li>
          {{/each}}
          </ul>
          <br/>
        {{/if}}
      {{/if}}
      {{#if model.selections.length}}
        <section class="selections">
          <p class="response-header" {{action 'toggleProperty' 'showSelections'}}>
            Selections
            <i class="fas {{if showSelections 'fa-chevron-down'}} {{unless showSelections 'fa-chevron-left'}}"></i>
          </p>
          {{#if showSelections}}
            <ul class="selections-list">
            {{#each model.selections as |selection|}}
              <li class="selections-list-item">
                {{#link-to 'workspace.submission.selection' selection.workspace selection.submission selection}}{{selection.text}}{{/link-to}}
              </li>
            {{/each}}
            </ul>
          {{/if}}
        </section>
        <section class="comments">
          <p class="response-header" {{action 'toggleProperty' 'showComments'}}>
            Comments
            <i class="fas {{if showComments 'fa-chevron-down'}} {{unless showComments 'fa-chevron-left'}}"></i>
          </p>
          {{#if showComments}}
            <ul class="comments-list">
            {{#each model.comments as |comment|}}
              <li class="comments-list-item">
                {{#link-to 'workspace.submission.selection' comment.workspace comment.submission comment.selection}}
                "{{comment.text}}"{{/link-to}}
              </li>
            {{/each}}
            </ul>
          {{/if}}
        </section>
      {{/if}}
    </section>
    <div class="response-info">
      {{#if explainEmptiness}}
        <p class="response-prefill">
          It looks like you haven't made any selections or comments for this submission. You should go back to the {{#link-to 'workspace.submission' model.workspace model.submission}}submission{{/link-to}} and create some selections and comments.
        </p>
      {{/if}}
    </div>
    <div class="response-compose">
      <p class="response-header">Message</p>
      {{textarea tabindex=1 id="responseTextarea" classBinding="hasText" value=replyText}}
      {{#if showNoteField}}
        <div class="approve-note">
          <h5>Note for Approver</h5>
          {{textarea class="approver-note" id="response-note" value=replyNote}}
        </div>
      {{/if}}
    </div>
    <div class="submit-buttons button-row">
      <button class="primary-button save-response" {{action 'save'}}>Send</button>
    </div>
  </section>


</div>