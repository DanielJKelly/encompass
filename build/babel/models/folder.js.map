{"version":3,"sources":["../../../app/models/folder.js"],"names":["Encompass","Folder","DS","Model","extend","Auditable","name","attr","weight","taggings","hasMany","async","parent","belongsTo","inverse","children","workspace","isTopLevel","isExpanded","sortProperties","taggedSelections","get","map","tagging","property","selections","filterBy","getEach","childSelections","toArray","forEach","pushObjects","uniq","_selections","submissions","_submissions","childSubmissions","hasSelection","selectionId","isAny","filteredChildren","sortBy","sortedChildren","Ember","computed","sort"],"mappings":";;AAAAA,UAAUC,MAAV,GAAmBC,GAAGC,KAAH,CAASC,MAAT,CAAgBJ,UAAUK,SAA1B,EAAqC;AACtDC,QAAMJ,GAAGK,IAAH,CAAQ,QAAR,CADgD;AAEtDC,UAAQN,GAAGK,IAAH,CAAQ,QAAR,CAF8C;AAGtDE,YAAUP,GAAGQ,OAAH,CAAW,SAAX,EAAsB,EAACC,OAAO,IAAR,EAAtB,CAH4C;AAItDC,UAAQV,GAAGW,SAAH,CAAa,QAAb,EAAuB,EAAEC,SAAS,UAAX,EAAuBH,OAAO,IAA9B,EAAvB,CAJ8C;AAKtDI,YAAUb,GAAGQ,OAAH,CAAW,QAAX,EAAqB,EAAEI,SAAS,QAAX,EAAqBH,OAAO,IAA5B,EAArB,CAL4C;AAMtDK,aAAWd,GAAGW,SAAH,CAAa,WAAb,EAA0B,EAACF,OAAO,IAAR,EAA1B,CAN2C;AAOtDM,cAAYf,GAAGK,IAAH,CAAQ,SAAR,CAP0C;AAQtDW,cAAY,KAR0C;AAStDC,kBAAgB,CAAC,QAAD,EAAW,MAAX,CATsC;;AAWtDC,oBAAkB,YAAU;AAC1B,WAAO,KAAKC,GAAL,CAAS,UAAT,EAAqBC,GAArB,CAA0B,UAASC,OAAT,EAAiB;AAChD,aAAOA,QAAQF,GAAR,CAAY,WAAZ,CAAP;AACD,KAFM,CAAP;AAGD,GAJiB,CAIhBG,QAJgB,CAIP,aAJO,CAXoC;;AAiBtDC,cAAY,YAAW;AACrB,WAAO,KAAKJ,GAAL,CAAS,UAAT,EACEK,QADF,CACW,WADX,EACwB,KADxB,EAEEC,OAFF,CAEU,WAFV,EAGED,QAHF,CAGW,WAHX,EAGwB,KAHxB,CAAP;AAID,GALW,CAKVF,QALU,CAKD,aALC,EAKc,kCALd,CAjB0C;;AAwBtDI,mBAAiB,YAAU;AACzB,QAAIH,aAAa,KAAKJ,GAAL,CAAS,YAAT,EAAuBQ,OAAvB,EAAjB;AACA,SAAKR,GAAL,CAAS,UAAT,EACGK,QADH,CACY,WADZ,EACyB,KADzB,EAEGC,OAFH,CAEW,aAFX,EAGGG,OAHH,CAGW,UAASF,eAAT,EAA0B;AACjCH,iBAAWM,WAAX,CAAuBH,eAAvB;AACD,KALH;;AAOA,WAAOH,WAAWO,IAAX,EAAP;AACD,GAVgB,CAUfR,QAVe,CAUN,eAVM,EAUW,4BAVX,CAxBqC;;AAoCtDS,eAAa,YAAW;AACtB,WAAO,KAAKZ,GAAL,CAAS,iBAAT,CAAP;AACA;;;;;;;;;;;AAYD,GAdY,CAcXG,QAdW,CAcF,oBAdE,EAcoB,iCAdpB,CApCyC;;AAoDtDU,eAAa,YAAW;AACtB,WAAO,KAAKb,GAAL,CAAS,YAAT,EACJK,QADI,CACK,WADL,EACkB,KADlB,EAEJC,OAFI,CAEI,YAFJ,EAGJK,IAHI,EAAP;AAID,GALY,CAKXR,QALW,CAKF,4BALE,CApDyC;;AA2DtDW,gBAAc,YAAW;AACvB,QAAID,cAAc,KAAKb,GAAL,CAAS,aAAT,EAAwBQ,OAAxB,EAAlB;;AAEA,SAAKR,GAAL,CAAS,UAAT,EACGK,QADH,CACY,WADZ,EACyB,KADzB,EAEGC,OAFH,CAEW,cAFX,EAGGG,OAHH,CAGW,UAASM,gBAAT,EAA2B;AAClCF,kBAAYH,WAAZ,CAAwBK,gBAAxB;AACD,KALH;;AAOA,WAAOF,YAAYF,IAAZ,EAAP;AACD,GAXa,CAWZR,QAXY,CAWH,gBAXG,EAWe,6BAXf,EAW8C,0BAX9C,CA3DwC;;AAwEtDa,gBAAc,sBAASC,WAAT,EAAsB;AAClC,WAAO,KAAKjB,GAAL,CAAS,UAAT,EACJkB,KADI,CACE,cADF,EACkBD,WADlB,CAAP;AAED,GA3EqD;;AA6EtDE,oBAAkB,YAAW;AAC3B,WAAO,KAAKnB,GAAL,CAAS,UAAT,EACJK,QADI,CACK,WADL,EACkB,KADlB,EAEJe,MAFI,CAEG,QAFH,EAEa,MAFb,CAAP;AAGD,GAJiB,CAIhBjB,QAJgB,CAIP,uBAJO,CA7EoC;;AAmFtDkB,kBAAgBC,MAAMC,QAAN,CAAeC,IAAf,CAAoB,kBAApB,EAAwC,gBAAxC;AAnFsC,CAArC,CAAnB","file":"folder.js","sourcesContent":["Encompass.Folder = DS.Model.extend(Encompass.Auditable, {\n  name: DS.attr('string'),\n  weight: DS.attr('number'),\n  taggings: DS.hasMany('tagging', {async: true}),\n  parent: DS.belongsTo('folder', { inverse: 'children', async: true }),\n  children: DS.hasMany('folder', { inverse: 'parent', async: true}),\n  workspace: DS.belongsTo('workspace', {async: true}),\n  isTopLevel: DS.attr('boolean'),\n  isExpanded: false,\n  sortProperties: ['weight', 'name'],\n\n  taggedSelections: function(){\n    return this.get('taggings').map( function(tagging){\n      return tagging.get('selection');\n    });\n  }.property('taggings.[]'),\n\n  selections: function() {\n    return this.get('taggings')\n            .filterBy('isTrashed', false)\n            .getEach('selection')\n            .filterBy('isTrashed', false);\n  }.property('taggings.[]', 'taggedSelections.@each.isTrashed'),\n\n  childSelections: function(){\n    var selections = this.get('selections').toArray();\n    this.get('children')\n      .filterBy('isTrashed', false)\n      .getEach('_selections')\n      .forEach(function(childSelections) {\n        selections.pushObjects(childSelections);\n      });\n\n    return selections.uniq();\n  }.property('selections.[]', 'selections.@each.isTrashed'),\n\n  _selections: function() { \n    return this.get('childSelections');\n    /*\n    var selections = this.get('selections').toArray();\n    this.get('children')\n      .filterBy('isTrashed', false)\n      .getEach('_selections')\n      .forEach(function(childSelections) {\n        selections.pushObjects(childSelections);\n      });\n\n    return selections.uniq();\n    }.property('selections.[]', 'selections.@each.isTrashed', 'children.@each._selections.[]'),\n    */\n  }.property('childSelections.[]', 'childSelections.@each.isTrashed'),\n\n  submissions: function() {\n    return this.get('selections')\n      .filterBy('isTrashed', false)\n      .getEach('submission')\n      .uniq(); \n  }.property('selections.@each.isTrashed'),\n\n  _submissions: function() {\n    var submissions = this.get('submissions').toArray();\n\n    this.get('children')\n      .filterBy('isTrashed', false)\n      .getEach('_submissions')\n      .forEach(function(childSubmissions) {\n        submissions.pushObjects(childSubmissions);\n      });\n\n    return submissions.uniq();\n  }.property('submissions.[]', 'children.@each._submissions', 'children.@each.isTrashed'),\n\n  hasSelection: function(selectionId) {\n    return this.get('taggings')\n      .isAny('selection.id', selectionId);\n  },\n\n  filteredChildren: function() {\n    return this.get('children')\n      .filterBy('isTrashed', false)\n      .sortBy('weight', 'name');\n  }.property('children.[].isTrashed'),\n\n  sortedChildren: Ember.computed.sort('filteredChildren', 'sortProperties'),\n});\n"]}