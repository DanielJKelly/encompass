{"version":3,"sources":["../../../app/components/selectable-area.js"],"names":["Encompass","SelectableAreaComponent","Ember","Component","extend","didInsertElement","comp","containerId","container","document","getElementById","style","position","selectionHighlighting","SelectionHighlighting","selectableContainerId","init","id","selection","getSelection","selectionType","sendAction","imageTagging","window","ImageTagging","targetContainer","onSave","tag","getTag","selections","imgTags","console","log","model","get","forEach","coordinates","arrCoords","split","length","coords","text","comments","parent","left","top","size","width","height","note","loadSelections","loadTags","myPropertyDidChange","willDestroyElement","destroy","highlighting","tagging","showingSelections","removeAllHighlights","highlightAllSelections","disableSelection","removeAllTags","showAllTags","disable","makingSelection","enableSelection","enable","observes","modelChanged","rerender"],"mappings":"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","file":"selectable-area.js","sourcesContent":["/**\n * Passed in by parent:\n * - model - the current submission model\n * - makingSelection\n * - showingSelections\n */\nEncompass.SelectableAreaComponent = Ember.Component.extend({\n  //classNameBindings: ['id'],\n  didInsertElement: function() {\n    var comp = this;\n    var containerId = 'submission_container';\n    var container = document.getElementById(containerId);\n    \n    if (!container) {\n      return;\n    }\n\n    if (container.style.position !== 'absolute') {\n      container.style.position = 'relative';\n    }\n\n    // set up the SelectionHighlighting object\n    comp.selectionHighlighting = new SelectionHighlighting({\n      selectableContainerId: containerId\n    });\n    comp.selectionHighlighting.init(function(id) {\n      var selection = comp.selectionHighlighting.getSelection(id);\n      selection.selectionType = 'selection';\n      comp.sendAction('addSelection', selection);\n    });\n    \n    // set up the ImageTagging object\n    comp.imageTagging = new window.ImageTagging({\n      targetContainer: containerId\n    });\n    comp.imageTagging.onSave(function(id) {\n      var tag = comp.imageTagging.getTag(id);\n      tag.selectionType = 'image-tag';\n      comp.sendAction('addSelection', tag);\n    });\n    \n    var selections = [];\n    var imgTags = [];\n\n    console.log(this.model); // This should never be null (ENC-479 possibility)\n    if (this.model) {\n      this.model.get('selections').forEach(function(selection) {\n        if (selection.get('isTrashed')) {\n          return; // don't include trashed selections\n        }\n      \n        var coordinates = selection.get('coordinates'),\n            arrCoords = [];\n\n        if(coordinates) {\n          arrCoords = coordinates.split(' ');\n        }\n\n        if (arrCoords.length === 6) {\n          selections[selections.length] = {\n            id: selection.get('id'),\n            coords: coordinates,\n            text: selection.get('text'),\n            comments: selection.get('comments')\n          };\n        } else if (arrCoords.length === 5) {\n          imgTags[imgTags.length] = {\n            id: selection.get('id'),\n            parent: arrCoords[0],\n            coords: {\n              left: arrCoords[1],\n              top: arrCoords[2]\n            },\n            size: {\n              width: arrCoords[3],\n              height: arrCoords[4]\n            },\n            note: selection.get('text'),\n            comments: selection.get('comments')\n          };\n        }\n      });\n    }\n\n    comp.selectionHighlighting.loadSelections(selections);\n    comp.imageTagging.loadTags(imgTags);\n    comp.myPropertyDidChange();\n  },\n  willDestroyElement: function() {\n    this.selectionHighlighting.destroy();\n    this.imageTagging.destroy();\n  },\n  myPropertyDidChange: function() {\n    var comp = this,\n      containerId = 'submission_container',\n      container = document.getElementById(containerId),\n      highlighting = comp.selectionHighlighting,\n      tagging = comp.imageTagging;\n    \n    if (!container) {\n      return;\n    }\n\n    console.log(\"Prop changed, showingSelections: \" + this.showingSelections );\n    if (this.showingSelections) {\n      highlighting.removeAllHighlights();\n      highlighting.highlightAllSelections();\n      highlighting.disableSelection();\n      tagging.removeAllTags();\n      tagging.showAllTags();\n      tagging.disable();\n    } else {\n      highlighting.removeAllHighlights();\n      tagging.removeAllTags();\n    }\n    if (this.makingSelection && !this.showingSelections) {\n      highlighting.enableSelection();\n      tagging.enable();\n    }\n  }.observes('this.showingSelections', 'this.makingSelection'),\n  \n  modelChanged: function() {\n    this.rerender(); //we want SelectionHighlighting.init() to be called again so that\n      //each of the DOM elements has an id ENC-450\n  }.observes('this.model.id')\n  \n});\n"]}