{"version":3,"sources":["../../../app/routes/responses_new_submission_route.js"],"names":["Encompass","ResponsesNewSubmissionRoute","Ember","Route","extend","ConfirmLeavingRoute","controllerName","renderTemplate","controller","model","set","render","afterModel","console","log","params","route","submission","store","find","submission_id","promise","RSVP","Promise","resolve","reject","then","sub","workspaces","get","selections","comments","w","s","c","response","createRecord","source","workspace","pushObjects","filterBy"],"mappings":";;AAAAA,UAAUC,2BAAV,GAAwCC,MAAMC,KAAN,CAAYC,MAAZ,CAAmBJ,UAAUK,mBAA7B,EAAkD;;AAExFC,kBAAgB,UAFwE;;AAIxFC,kBAAgB,wBAASC,UAAT,EAAqBC,KAArB,EAA4B;AAC1CD,eAAWE,GAAX,CAAe,OAAf,EAAwBD,KAAxB;AACAD,eAAWE,GAAX,CAAe,SAAf,EAA0B,KAA1B;AACA,SAAKC,MAAL,CAAY,UAAZ;AAED,GATuF;;AAWxFC,cAAY,oBAASH,KAAT,EAAe;AACzBI,YAAQC,GAAR,CAAYL,KAAZ;AACD,GAbuF;;AAexFA,SAAO,eAASM,MAAT,EAAiB;AACtB,QAAIC,QAAa,IAAjB;AACA;AACA,QAAIC,aAAa,KAAKC,KAAL,CAAWC,IAAX,CAAgB,YAAhB,EAA8BJ,OAAOK,aAArC,CAAjB;;AAEA,QAAIC,UAAU,IAAInB,MAAMoB,IAAN,CAAWC,OAAf,CAAuB,UAASC,OAAT,EAAkBC,MAAlB,EAA0B;AAC7DR,iBAAWS,IAAX,CAAgB,UAASC,GAAT,EAAa;AAC3B,YAAIC,aAAaD,IAAIE,GAAJ,CAAQ,YAAR,CAAjB;AACA,YAAIC,aAAaH,IAAIE,GAAJ,CAAQ,YAAR,CAAjB;AACA,YAAIE,WAAaJ,IAAIE,GAAJ,CAAQ,UAAR,CAAjB;AACAD,mBAAWF,IAAX,CAAgB,UAASM,CAAT,EAAW;AACzBF,qBAAWJ,IAAX,CAAgB,UAASO,CAAT,EAAW;AACzBF,qBAASL,IAAT,CAAc,UAASQ,CAAT,EAAW;AACvB,kBAAIC,WAAWnB,MAAMa,GAAN,CAAU,OAAV,EAAmBO,YAAnB,CAAgC,UAAhC,EAA4C;AACzDC,wBAAQ,YADiD;AAEzDpB,4BAAYU,GAF6C;AAGzDW,2BAAWN,EAAEH,GAAF,CAAM,aAAN,CAH8C,CAGzB;AAHyB,eAA5C,CAAf;AAKAM,uBAASN,GAAT,CAAa,YAAb,EAA2BH,IAA3B,CAAgC,UAASI,UAAT,EAAqB;AACnDA,2BAAWS,WAAX,CAAuBN,EAAEO,QAAF,CAAW,WAAX,EAAwB,KAAxB,CAAvB;AACAL,yBAASN,GAAT,CAAa,UAAb,EAAyBH,IAAzB,CAA8B,UAASK,QAAT,EAAmB;AAC/CA,2BAASQ,WAAT,CAAqBL,EAAEM,QAAF,CAAW,WAAX,EAAwB,KAAxB,CAArB;AACAhB,0BAAQW,QAAR;AACD,iBAHD;AAID,eAND;AAOD,aAbD;AAcD,WAfD;AAgBD,SAjBD;AAkBD,OAtBD;AAuBD,KAxBa,CAAd;AAyBA,WAAOd,OAAP;AACD;;AA9CuF,CAAlD,CAAxC","file":"responses_new_submission_route.js","sourcesContent":["Encompass.ResponsesNewSubmissionRoute = Ember.Route.extend(Encompass.ConfirmLeavingRoute, {\n\n  controllerName: 'response',\n\n  renderTemplate: function(controller, model) {\n    controller.set('model', model);\n    controller.set('editing', false);\n    this.render('response');\n\n  },\n\n  afterModel: function(model){\n    console.log(model);\n  },\n\n  model: function(params) {\n    var route      = this;\n    // jshint camelcase: false\n    var submission = this.store.find('submission', params.submission_id);\n\n    var promise = new Ember.RSVP.Promise(function(resolve, reject) {\n      submission.then(function(sub){\n        var workspaces = sub.get('workspaces');\n        var selections = sub.get('selections');\n        var comments   = sub.get('comments');\n        workspaces.then(function(w){\n          selections.then(function(s){\n            comments.then(function(c){\n              var response = route.get('store').createRecord('response', {\n                source: 'submission',\n                submission: sub,\n                workspace: w.get('firstObject') //hmmm\n              });\n              response.get('selections').then(function(selections) {\n                selections.pushObjects(s.filterBy('isTrashed', false));\n                response.get('comments').then(function(comments) {\n                  comments.pushObjects(c.filterBy('isTrashed', false));\n                  resolve(response);\n                });\n              });\n            });\n          });\n        });\n      });\n    });\n    return promise;\n  }\n\n});\n"]}