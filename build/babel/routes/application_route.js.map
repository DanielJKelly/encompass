{"version":3,"sources":["../../../app/routes/application_route.js"],"names":["Encompass","ApplicationRoute","Ember","Route","extend","model","store","get","currentUser","RSVP","Promise","resolve","reject","query","alias","then","result","user","console","error","currentUserError","err","window","alert","location","href","afterModel","transition","log","transitionTo","actions","openModal","modalName","controllerFor","set","render","into","outlet","closeModal","disconnectOutlet","parentView","openPanel","panelName","closePanel","doneTour","Date","save","guiders","hideAll","reloadPage","reload"],"mappings":";;AAAA;;;;;;;;;AASAA,UAAUC,gBAAV,GAA6BC,MAAMC,KAAN,CAAYC,MAAZ,CAAmB,EAAE;AAChDC,SAAO,iBAAW;AAChB,QAAIC,QAAQ,KAAKC,GAAL,CAAS,OAAT,CAAZ;AACA,QAAIC,cAAc,IAAIN,MAAMO,IAAN,CAAWC,OAAf,CAAuB,UAASC,OAAT,EAAkBC,MAAlB,EAA0B;AACjEN,YAAMO,KAAN,CAAY,MAAZ,EAAoB,EAACC,OAAO,SAAR,EAApB,EAAwCC,IAAxC,CAA8C,UAAUC,MAAV,EAAkB;AAC9D,YAAIC,OAAOD,OAAOT,GAAP,CAAW,aAAX,CAAX;AACA,YAAGS,OAAOT,GAAP,CAAW,QAAX,IAAuB,CAA1B,EAA6B;AAC3BW,kBAAQC,KAAR,CAAc,sEAAd;AACD;AACDR,gBAAQM,IAAR;AACD,OAND,EAMG,SAASG,gBAAT,CAA0BC,GAA1B,EAA8B;AAC/BT,eAAOS,GAAP;AACAC,eAAOC,KAAP,CAAa,8CAAb;AACAD,eAAOE,QAAP,CAAgBC,IAAhB,GAAuB,GAAvB;AACD,OAVD;AAWD,KAZiB,CAAlB;AAaA,WAAOjB,WAAP;AACD,GAjB6C;;AAmB9CkB,cAAY,oBAAST,IAAT,EAAeU,UAAf,EAA2B;AACrCT,YAAQU,GAAR,CAAY,iBAAZ,EAA+BX,IAA/B;AACAC,YAAQU,GAAR,CAAY,SAAZ,EAAuBX,KAAKV,GAAL,CAAS,iBAAT,CAAvB;AACA;AACA,QAAG,CAACU,KAAKV,GAAL,CAAS,iBAAT,CAAJ,EAAiC;AAC/B,WAAKsB,YAAL,CAAkB,GAAlB;AACD,KAFD,MAEO,IAAG,CAACZ,KAAKV,GAAL,CAAS,SAAT,CAAJ,EAAyB;AAC9B,WAAKsB,YAAL,CAAkB,cAAlB;AACD;AACF,GA5B6C;;AA8B9CC,WAAS;AACP;AACAC,eAAW,mBAASC,SAAT,EAAoB3B,KAApB,EAA2B;AACpCa,cAAQU,GAAR,CAAY,gCAAgCI,SAA5C;AACA,UAAG3B,KAAH,EAAU;AACR,aAAK4B,aAAL,CAAmBD,SAAnB,EAA8BE,GAA9B,CAAkC,OAAlC,EAA2C7B,KAA3C;AACD;AACD,aAAO,KAAK8B,MAAL,CAAYH,SAAZ,EAAuB;AAC5BI,cAAM,aADsB;AAE5BC,gBAAQ;AAFoB,OAAvB,CAAP;AAID,KAXM;;AAaPC,gBAAY,sBAAW;AACrB,aAAO,KAAKC,gBAAL,CAAsB;AAC3BF,gBAAQ,OADmB;AAE3BG,oBAAY;AAFe,OAAtB,CAAP;AAID,KAlBM;;AAoBPC,eAAW,mBAASC,SAAT,EAAoBrC,KAApB,EAA2B;AACpC,UAAGA,KAAH,EAAU;AACR,aAAK4B,aAAL,CAAmBS,SAAnB,EAA8BR,GAA9B,CAAkC,OAAlC,EAA2C7B,KAA3C;AACD;AACD,aAAO,KAAK8B,MAAL,CAAYO,SAAZ,EAAuB;AAC5BN,cAAM,aADsB;AAE5BC,gBAAQ;AAFoB,OAAvB,CAAP;AAID,KA5BM;;AA8BPM,gBAAY,sBAAW;AACrB,aAAO,KAAKJ,gBAAL,CAAsB;AAC3BF,gBAAQ,OADmB;AAE3BG,oBAAY;AAFe,OAAtB,CAAP;AAID,KAnCM;;AAqCPI,cAAU,oBAAW;AACnB,UAAI3B,OAAO,KAAKV,GAAL,CAAS,OAAT,CAAX;AACAU,WAAKiB,GAAL,CAAS,UAAT,EAAqB,IAAIW,IAAJ,EAArB;AACA5B,WAAK6B,IAAL;AACAC,cAAQC,OAAR;AACD,KA1CM;;AA4CPC,gBAAY,sBAAW;AACrB3B,aAAOE,QAAP,CAAgB0B,MAAhB;AACD;;AA9CM;AA9BqC,CAAnB,CAA7B","file":"application_route.js","sourcesContent":["/**\n  * # Application Route\n  * @description This is the main application route. Here we expose application wide:\n                 + Models &\n                 + Actions\n  * @author Amir Tahvildaran <amir@mathforum.org>, Damola Mabogunje <damola@mathforum.org>\n  * @since 1.0.0\n  * @todo Manage the current user without setting on the Encompass object itself.\n  */\nEncompass.ApplicationRoute = Ember.Route.extend({ //the application route can't require authentication since it's getting the user\n  model: function() {\n    var store = this.get('store');\n    var currentUser = new Ember.RSVP.Promise(function(resolve, reject) {\n      store.query('user', {alias: 'current'}).then( function (result) {\n        var user = result.get('firstObject');\n        if(result.get('length') > 1) {\n          console.error('something is wrong: current user request is returning multiple items');\n        }\n        resolve(user);\n      }, function currentUserError(err){\n        reject(err);\n        window.alert('You are no longer logged in, redirecting you');\n        window.location.href = '/';\n      });\n    });\n    return currentUser;\n  },\n\n  afterModel: function(user, transition) {\n    console.log('user afterModel', user);\n    console.log('is auth', user.get('isAuthenticated'));\n    //not crazy that this is duplicated here and in AuthenticatedRoute...\n    if(!user.get('isAuthenticated')) {\n      this.transitionTo('/');\n    } else if(!user.get('isAuthz')) {\n      this.transitionTo('unauthorized');\n    }\n  },\n\n  actions: {\n    // TODO: Remove all the modal stuff\n    openModal: function(modalName, model) {\n      console.log(\"Application opening modal: \" + modalName );\n      if(model) {\n        this.controllerFor(modalName).set('model', model);\n      }\n      return this.render(modalName, {\n        into: 'application',\n        outlet: 'modal'\n      });\n    },\n\n    closeModal: function() {\n      return this.disconnectOutlet({\n        outlet: 'modal',\n        parentView: 'application'\n      });\n    },\n\n    openPanel: function(panelName, model) {\n      if(model) {\n        this.controllerFor(panelName).set('model', model);\n      }\n      return this.render(panelName, {\n        into: 'application',\n        outlet: 'modal'\n      });\n    },\n\n    closePanel: function() {\n      return this.disconnectOutlet({\n        outlet: 'modal',\n        parentView: 'application'\n      });\n    },\n\n    doneTour: function() {\n      var user = this.get('model');\n      user.set('seenTour', new Date());\n      user.save();\n      guiders.hideAll();\n    },\n\n    reloadPage: function() {\n      window.location.reload();\n    }\n\n  }\n});\n"]}