{"version":3,"sources":["../../../app/routes/workspace_submission_route.js"],"names":["Encompass","WorkspaceSubmissionRoute","Ember","Route","extend","setupController","controller","model","console","log","_super","currentWs","get","set","afterModel","transition","activate","controllerFor","deactivate","renderTemplate","route","foldersController","commentsController","workspaceController","workspace","modelFor","render","user","run","schedule","info","send","actions","reload","refresh","startTour","type","addSelection","selection","tagSelection","tags","then","folders","lcFolders","forEach","f","toLowerCase","replace","tag","_","keys","includes","fileSelectionInFolder","selectionId","folder","store","selections","filterBy","tagging","createRecord","save","obj","debug","taggings","pushObject"],"mappings":"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","file":"workspace_submission_route.js","sourcesContent":["/**\n  * # Workspace Submission Route\n  * @description This route renders the templates for working on a submission in a workspace\n    model: a single submission (the current submission)\n  * @author Damola Mabogunje <damola@mathforum.org>, Amir Tahvildaran <amir@mathforum.org>\n  * @since 1.0.1\n  * @see workspace_submissions_route\n  */\nEncompass.WorkspaceSubmissionRoute = Ember.Route.extend({\n\n  /*\n  model: function(params){\n    console.log(\"W-S Route model hook for: \" + params.submission_id );\n    this.get('store').findRecord('submission', params.submission_id );\n  },\n  */\n\n  setupController: function(controller, model) {\n    console.log(\"W-S Route!\");\n    this._super(controller, model);\n    var currentWs = controller.get('currentWorkspace');\n    currentWs.set('owner', currentWs.get('owner'));\n  },\n\n  afterModel: function( model, transition ){\n    console.log(\"W-s After Model!\");\n  },\n\n  activate: function() {\n    this.controllerFor('application').set('isSmallHeader', true);\n  },\n\n  deactivate: function() {\n    this.controllerFor('application').set('isSmallHeader', false);\n  },\n\n  renderTemplate: function(controller, model) {\n    console.log(\"Rendering template for W-S\");\n    var route = this;\n\n    var foldersController = route.controllerFor('folders');\n    var commentsController = route.controllerFor('comments');\n    var workspaceController = route.controllerFor('workspace.submissions');\n\n    var workspace = this.modelFor('workspace');\n    foldersController.set('model', workspace.get('folders'));\n\n    route.render();\n\n    /*\n    this.render('folders', {\n      into: 'workspace.submission',\n      outlet: 'folders',\n      controller: foldersController\n    });\n    */\n\n    /*\n    this.render('submissions', {\n      into: 'workspace.submission',\n      outlet: 'submissions',\n      controller: workspaceController\n    });\n    */\n\n      /*\n    this.render('comments', {\n      into: 'workspace.submission',\n      outlet: 'comments'\n    });\n    */\n\n\n    /*\n    route.render('submission', {\n      into: 'submissions',\n      outlet: 'submission'\n    });\n    */\n\n    var user = this.modelFor('application');\n\n    Ember.run.schedule('afterRender', function() { \n      if(!user.get('seenTour')) {\n        //user.set('seenTour', new Date());\n        //user.save();\n        console.info('starting the tour!'); \n        route.send('startTour', 'workspace');\n      }\n    });\n  },\n\n  actions: {\n    reload: function() {\n      this.refresh();\n    },\n\n    startTour: function(type) {\n      console.log('ignoring tour');\n      //guiders.show('workspace');\n    },\n    addSelection: function( selection ){\n      console.log(\"W-S Route: Got add selection action!\");\n    },\n\n    tagSelection: function(selection, tags){\n      var route = this;\n      console.log('tagging selection: ' + selection);\n      var workspace = this.modelFor('workspace');\n      workspace.get('folders').then(function(folders){\n        var lcFolders = {};\n        folders.forEach(function(f){\n          lcFolders[f.get('name').toLowerCase().replace(/\\s+/g, '')] = f;\n        });\n        tags.forEach(function(tag){\n          if(_.keys(lcFolders).includes(tag)) {\n            route.send('fileSelectionInFolder', selection.get('id'), lcFolders[tag]);\n          }\n        });\n      });\n    },\n    fileSelectionInFolder: function(selectionId, folder){\n      console.log('tagging selection: ' + selectionId);\n      var store = this.get('store');\n\n      folder.get('workspace')\n        .then(function(workspace) {\n          workspace.get('selections')\n            .then(function(selections) {\n              var selection = selections.filterBy('id', selectionId).get('firstObject');\n              var tagging = store.createRecord('tagging', {\n                workspace: workspace,\n                folder: folder,\n                selection: selection\n              });\n\n              tagging.save().then(function(obj) {\n                console.debug('saved tag: ' + obj.get('id'));\n                selection.get('taggings').then(function(taggings){\n                  taggings.pushObject(tagging);\n                });\n                folder.get('taggings').then(function(taggings){\n                  taggings.pushObject(tagging);\n                });\n              });\n            });\n        });\n    }\n  }\n});\n"]}